<h3 class="title"><%=l(:field_project).pluralize%></h3>

<div class="actions_links">
  SÃ©lection :
  <%= link_to l("select_all"), '#', id: "link_select_all", :onclick=> "select_all()" %>
  |
  <%= link_to l("select_none"), '#', id: "link_select_all", :onclick=> "select_none()" %>
</div>

<div class="columns" id="project_nested_list">
  <% template_projects = @issue_template.projects.all
     allowed_projects =  @issue_template.allowed_target_projects
  %>
  <%= render_project_nested_lists(allowed_projects|template_projects) do |project|
    content_tag('label',
                check_box_tag(
                    'project_ids[]',
                    project.id,
                    @issue_template != nil && template_projects.include?(project),
                    disabled: allowed_projects.include?(project) ? false : true,
                    :class => ("inactive" unless allowed_projects.include?(project))
                ) + ' ' + h(project.name), :class => ("inactive" unless allowed_projects.include?(project))
    )
  end %>
</div>

<p class="buttons">
  <%= submit_tag l(:button_apply), :name => nil, :onclick => "updateSelectedProjects();hideModal(this);", :type => 'button', :id=> 'button_apply_projects' %>
</p>

<script type="text/javascript">

  function updateSelectedProjects() {
    $("select#issue_template_project_ids option").each(function() { this.selected = ""; });
    var htmlContent = "";
    $("input:checkbox[name='project_ids[]']:checked").each(function()
    {
      $("#issue_template_project_ids option[value=" + $(this).val() +"]").attr("selected","selected");
    });
    $("input:checkbox[name='project_ids[]']:checked:not(.inactive)").each(function()
    {
      htmlContent += "<span class=\"list_templates_projects_names\">"+ $(this).closest('label').text() + "</span>";
    });
    $("#my_projects").html(htmlContent);
  }

  function select_all(){
    $("input:checkbox[name='project_ids[]']").each(function()
    {
      $(this).attr("checked","checked") ;
    });
  }

  function select_none(){
    $("input:checkbox[name='project_ids[]']:checked:not(.inactive)").each(function()
    {
      $(this).attr("checked",false) ;
    });
  }

</script>
